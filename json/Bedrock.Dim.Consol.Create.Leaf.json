{"Parameters": [{"Prompt": "Dimension", "Type": "String", "Value": "", "Name": "pDimension"}, {"Prompt": "Consolidation Name", "Type": "String", "Value": "", "Name": "pConsol"}, {"Prompt": "The element is a member of the consolidation.", "Type": "String", "Value": "", "Name": "pMemberConsol"}, {"Prompt": "Debug Mode", "Type": "Numeric", "Value": 0, "Name": "pDebug"}], "DataProcedure": "\r\n#****Begin: Generated Statements***\r\n#****End: Generated Statements****\r\n", "Variables": [{"Position": 1, "EndByte": 0, "StartByte": 0, "Type": "String", "Name": "vElement"}], "HasSecurityAccess": true, "UIData": "CubeAction=1511\fDataAction=1503\fCubeLogChanges=0\f", "Name": "Bedrock.Dim.Consol.Create.Leaf", "PrologProcedure": "\r\n#****Begin: Generated Statements***\r\n#****End: Generated Statements****\r\n\r\n### Start Prolog ###\r\n\r\n#####################################################################################\r\n##~~Copyright bedrocktm1.org 2011 www.bedrocktm1.org/how-to-licence.php Ver 3.0.2~~##\r\n#####################################################################################\r\n\r\n\r\n### Constants ###\r\n\r\ncProcess = 'Bedrock.Dim.Consol.Create.Leaf';\r\ncTimeStamp = TimSt( Now, '\\Y\\m\\d\\h\\i\\s' );\r\nsRandomInt = NumberToString( INT( RAND( ) * 1000 ));\r\ncDebugFile = GetProcessErrorFileDirectory | cProcess | '.' | cTimeStamp | '.' | sRandomInt ;\r\n\r\n\r\n### Initialise Debug ###\r\n\r\nIf( pDebug >= 1 );\r\n\r\n  # Set debug file name\r\n  sDebugFile = cDebugFile | 'Prolog.debug';\r\n\r\n  # Log start time\r\n  AsciiOutput( sDebugFile, 'Process Started: ' | TimSt( Now, '\\d-\\m-\\Y \\h:\\i:\\s' ) );\r\n\r\n  # Log parameters\r\n  AsciiOutput( sDebugFile, 'Parameters: pDimension      : ' | pDimension );\r\n  AsciiOutput( sDebugFile, '            pConsol         : ' | pConsol );\r\n  AsciiOutput( sDebugFile, '            pMemberConsol   : ' | pMemberConsol );\r\nEndIf;\r\n\r\n\r\n### Validate Parameters ###\r\n\r\nnErrors = 0;\r\n\r\nIF( \r\nTrim( pDimension ) @= '' );\r\n  ## No dimension nominated.\r\n  nErrors = 1;\r\n  If( pDebug >= 1 );\r\n    sMessage = 'No dimension specified.';\r\n    AsciiOutput( sDebugFile, sMessage );\r\n  EndIf;\r\n  PROCESSBREAK;\r\nEndIf;\r\n\r\nIF( \r\nSUBST( pDimension, 1, 1 ) @= '}' );\r\n  ## Nominated dimension is a system dimension.\r\n  nErrors = 1;\r\n  If( pDebug >= 1 );\r\n    sMessage = 'Can not modify a system dimension with this Bedrock.';\r\n    AsciiOutput( sDebugFile, sMessage );\r\n  EndIf;\r\n  PROCESSBREAK;\r\nEndIf;\r\n\r\nIf( \r\nDimensionExists( pDimension ) = 0 );\r\n  ## Dimension does not exist in the model.\r\n  nErrors = 1;\r\n  If( pDebug >= 1 );\r\n    sMessage = 'The dimension does not exist in the model: ' | pDimension;\r\n    AsciiOutput( sDebugFile, sMessage );\r\n  EndIf;\r\n  ItemReject( sMessage );\r\nEndIf;\r\n\r\nIF( \r\nTrim( pDimension ) @= '' );\r\n  ## No dimension nominated.\r\n  nErrors = 1;\r\n  If( pDebug >= 1 );\r\n    sMessage = 'No dimension specified.';\r\n    AsciiOutput( sDebugFile, sMessage );\r\n  EndIf;\r\n  PROCESSBREAK;\r\nEndIf;\r\n\r\n\r\n## Validate consolidation Parameter\r\npConsol = Trim( pConsol );\r\nIf( pConsol @= '' );\r\n  ## No consolidation nominated, us default name.\r\n  pConsol = 'Total Leaf Elements';\r\n    If( pDebug >= 1 );\r\n    sMessage = 'No Consolidation point nominated, using default consolidation \"Total Leaf Elements\".';\r\n    AsciiOutput( sDebugFile, sMessage );\r\n  EndIf;\r\nEndIf;\r\n\r\n\r\n## Validate Member Consolidation\r\npMemberConsol = Trim( pMemberConsol );\r\nIF( \r\npMemberConsol @<> '' );\r\n  ## A member consolidation has been nominated.\r\n  IF(\r\n  DIMIX( pDimension, pMemberConsol ) = 0 );\r\n  ## The Member Consolidation does not exist in the dimension.\r\n    nErrors = 1;\r\n    If( pDebug >= 1 );\r\n      sMessage = 'The Member Consolidation does not exist in the model: ' | pMemberConsol;\r\n      AsciiOutput( sDebugFile, sMessage );\r\n    EndIf;\r\n    ItemReject( sMessage );\r\n  ENDIF;\r\nENDIF;\r\n\r\n\r\n\r\n### Check for errors in Validate Parameters ###\r\n\r\nIf( nErrors <> 0 );\r\n  ProcessBreak;\r\nEndIf;\r\n\r\n### UNWIND CONSOLIDATION ###\r\nIF( \r\nDIMIX( pDimension, pConsol ) > 0 );\r\n  ExecuteProcess('Bedrock.Dim.Hierarchy.Unwind.Consolidation'\r\n  , 'pDimension', pDimension\r\n  , 'pConsol', pConsol\r\n  , 'pRecursive', 0\r\n  , 'pDebug', pDebug\r\n  );\r\n\r\n  IF( pDebug >= 1 );\r\n    sMessage = 'Unwind consolidation: ' | pConsol;\r\n    AsciiOutput( sDebugFile, sMessage );\r\n  EndIf;\r\nELSE;\r\n  DimensionElementInsert( pDimension, '', pConsol, 'C' );\r\n\r\n  IF( pDebug >= 1 );\r\n    sMessage = 'Add consolidation: ' | pConsol;\r\n    AsciiOutput( sDebugFile, sMessage );\r\n  EndIf;\r\n\r\nENDIF;\r\n\r\n\r\n### Assign Datasource ###\r\n\r\nDatasourceNameForServer = pDimension;\r\nDataSourceDimensionSubset = 'All';\r\n\r\n\r\n### End Prolog ###\r\n", "MetadataProcedure": "\r\n#****Begin: Generated Statements***\r\n#****End: Generated Statements****\r\n\r\n\r\n### Start Metadata ###\r\n\r\n#####################################################################################\r\n##~~Copyright bedrocktm1.org 2011 www.bedrocktm1.org/how-to-licence.php Ver 3.0.2~~##\r\n#####################################################################################\r\n\r\n\r\n### Initialise Debug ###\r\n\r\nIf( pDebug >= 1 );\r\n\r\n  # Set debug file name\r\n  sDebugFile = cDebugFile | 'Metadata.debug';\r\n\r\nEndIf;\r\n\r\n\r\n### VALIDATE RECORD ###\r\n\r\nsElType = DTYPE( pDimension, vElement );\r\nIF(\r\nsElType @<> 'N' );\r\n  ## The element is not a 'N' element.\r\n  ITEMSKIP;\r\n\r\nENDIF;\r\n\r\nIF( \r\npMemberConsol @<> '' );\r\n  ## A member consolidation is been used.\r\n  IF(\r\n  ELISANC( pDimension, pMemberConsol, vElement ) = 0 );\r\n  ## The element is not a member of the nominated consolidation.\r\n    ITEMSKIP;\r\n    \r\n  ENDIF;\r\nENDIF;  \r\n\r\n\r\n### BUILD CONSOLIDATION ###\r\n\r\nIf( pDebug >= 1 );\r\n  AsciiOutput( sDebugFile, 'Element \"' | vElement | '\" has been added to \"' | pConsol | '\" consolidation.' );\r\nEndIf;\r\nIf( pDebug <= 1 );\r\n  DimensionElementComponentAdd( pDimension, pConsol, vElement, 1 );\r\nEndIf;\r\n\r\n\r\n### End Metadata ###", "DataSource": {"dataSourceNameForServer": "}Dimensions", "dataSourceNameForClient": "}Dimensions", "Type": "TM1DimensionSubset", "subset": "All"}, "EpilogProcedure": "\r\n#****Begin: Generated Statements***\r\n#****End: Generated Statements****\r\n", "VariablesUIData": ["VarType=32\fColType=827\f"]}